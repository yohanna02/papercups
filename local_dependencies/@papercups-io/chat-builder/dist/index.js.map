{"version":3,"file":"index.js","sources":["../src/components/PapercupsBranding.tsx","../src/helpers/utils.ts","../src/helpers/logger.ts","../src/helpers/visibility.ts","../src/track/info.ts","../src/track/helpers.ts","../src/components/ChatBuilder.tsx","../src/helpers/config.ts","../src/components/ChatBody.tsx","../src/components/ChatToggle.tsx","../src/components/ChatFooter.tsx","../src/components/ChatHeader.tsx"],"sourcesContent":["import React from 'react';\n\nconst PapercupsBranding = () => {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        margin: 8,\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}\n    >\n      <a\n        href='https://papercups.io?utm_source=papercups&utm_medium=chat&utm_campaign=chat-builder-link'\n        target='_blank'\n        rel='noopener noreferrer'\n        style={{\n          color: 'gray',\n          opacity: 0.8,\n          transition: '0.2s',\n        }}\n      >\n        Powered by Papercups\n      </a>\n    </div>\n  );\n};\n\nexport default PapercupsBranding;\n","import {Message} from './types';\n\nexport function noop() {}\n\n// TODO: handle this on the server instead\nexport function now() {\n  const date = new Date();\n\n  return new Date(\n    date.getUTCFullYear(),\n    date.getUTCMonth(),\n    date.getUTCDate(),\n    date.getUTCHours(),\n    date.getUTCMinutes(),\n    date.getUTCSeconds()\n  );\n}\n\nexport function sleep(ms: number) {\n  return new Promise((res) => setTimeout(res, ms));\n}\n\n// Returns the words (or whatever substrings based on the `separator`)\n// in a string up until the point of meeting the`max` character limit\nexport function shorten(str: string, max: number, separator = ' ') {\n  if (str.length <= max) {\n    return str;\n  }\n\n  return str.substr(0, str.lastIndexOf(separator, max)).concat('...');\n}\n\nexport function shouldActivateGameMode(message?: string) {\n  if (!message || !message.length) {\n    return false;\n  }\n\n  return (\n    [\n      '/play2048',\n      '/xyzzy',\n      '/poweroverwhelming',\n      '/howdoyouturnthison',\n      'what is 2^11',\n      'what is 2^11?',\n      \"what's 2^11\",\n      \"what's 2^11?\",\n    ].indexOf(message.toLowerCase()) !== -1\n  );\n}\n\nexport function setupPostMessageHandlers(w: any, handler: (msg: any) => void) {\n  const cb = (msg: any) => {\n    handler(msg);\n  };\n\n  if (w.addEventListener) {\n    w.addEventListener('message', cb);\n\n    return () => w.removeEventListener('message', cb);\n  } else {\n    w.attachEvent('onmessage', cb);\n\n    return () => w.detachEvent('message', cb);\n  }\n}\n\nexport const setupCustomEventHandlers = (\n  w: any,\n  events: Array<string>,\n  handlers: (e: any) => void\n) => {\n  if (w.addEventListener) {\n    for (const event of events) {\n      w.addEventListener(event, handlers);\n    }\n\n    return () => events.map((event) => w.removeEventListener(event, handlers));\n  } else {\n    console.error('Custom events are not supported in your browser!');\n\n    return noop;\n  }\n};\n\nexport const isCustomerMessage = (\n  message: Message,\n  customerId?: string | null\n): boolean => {\n  return (\n    message.customer_id === customerId ||\n    (!!message.sent_at && message.type === 'customer')\n  );\n};\n\nexport const areDatesEqual = (x?: string, y?: string) => {\n  if (!x || !y) {\n    return false;\n  }\n\n  return Math.floor(+new Date(x) / 1000) === Math.floor(+new Date(y) / 1000);\n};\n\nexport const isValidUuid = (id: any) => {\n  if (!id || !id.length) {\n    return false;\n  }\n\n  const regex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\n  return regex.test(id);\n};\n","class Logger {\n  debugModeEnabled: boolean;\n\n  constructor(debugModeEnabled?: boolean) {\n    this.debugModeEnabled = !!debugModeEnabled;\n  }\n\n  debug(...args: any) {\n    if (!this.debugModeEnabled) {\n      return;\n    }\n\n    console.debug(...args);\n  }\n\n  log(...args: any) {\n    if (!this.debugModeEnabled) {\n      return;\n    }\n\n    console.log(...args);\n  }\n\n  info(...args: any) {\n    console.info(...args);\n  }\n\n  warn(...args: any) {\n    console.warn(...args);\n  }\n\n  error(...args: any) {\n    console.error(...args);\n  }\n}\n\nexport default Logger;\n","export const getBrowserVisibilityInfo = (document: any) => {\n  if (typeof document.hidden !== 'undefined') {\n    return {\n      hidden: 'hidden',\n      event: 'visibilitychange',\n      state: 'visibilityState',\n    };\n  } else if (typeof document.mozHidden !== 'undefined') {\n    return {\n      hidden: 'mozHidden',\n      event: 'mozvisibilitychange',\n      state: 'mozVisibilityState',\n    };\n  } else if (typeof document.msHidden !== 'undefined') {\n    return {\n      hidden: 'msHidden',\n      event: 'msvisibilitychange',\n      state: 'msVisibilityState',\n    };\n  } else if (typeof document.webkitHidden !== 'undefined') {\n    return {\n      hidden: 'webkitHidden',\n      event: 'webkitvisibilitychange',\n      state: 'webkitVisibilityState',\n    };\n  } else {\n    return {\n      hidden: null,\n      event: null,\n      state: null,\n    };\n  }\n};\n\nexport const isWindowHidden = (document: any): boolean => {\n  const {hidden} = getBrowserVisibilityInfo(document);\n\n  if (!hidden) {\n    return false;\n  }\n\n  return !!document[hidden];\n};\n\nexport const addVisibilityEventListener = (\n  document: any,\n  handler: (e: any) => void\n) => {\n  const {event} = getBrowserVisibilityInfo(document);\n\n  document.addEventListener(event, handler, false);\n\n  return () => document.removeEventListener(event, handler);\n};\n","import {helpers} from './helpers';\n\nexport function getUserInfo(win: any) {\n  const {\n    navigator,\n    userAgent,\n    windowOpera,\n    intl,\n    each,\n    extend,\n    includes,\n    timestamp,\n    stripEmptyProperties,\n    getQueryParam,\n  } = helpers(win);\n\n  // Mostly borrowed from:\n  // https://github.com/PostHog/posthog-js/blob/dbfac85a2808626e3c1780013a9075d5c9fd0971/src/utils.js#L1433\n  const info = {\n    campaignParams: function () {\n      const campaign_keywords = 'utm_source utm_medium utm_campaign utm_content utm_term'.split(\n        ' '\n      );\n      let kw = '';\n      let params: any = {};\n\n      each(campaign_keywords, function (kwkey: string) {\n        kw = getQueryParam(document.URL, kwkey);\n\n        if (kw.length) {\n          params[kwkey] = kw;\n        }\n      });\n\n      return params;\n    },\n\n    searchEngine: function (referrer: any) {\n      if (referrer.search('https?://(.*)google.([^/?]*)') === 0) {\n        return 'google';\n      } else if (referrer.search('https?://(.*)bing.com') === 0) {\n        return 'bing';\n      } else if (referrer.search('https?://(.*)yahoo.com') === 0) {\n        return 'yahoo';\n      } else if (referrer.search('https?://(.*)duckduckgo.com') === 0) {\n        return 'duckduckgo';\n      } else {\n        return null;\n      }\n    },\n\n    searchInfo: function (referrer: any) {\n      let search = info.searchEngine(referrer);\n      let param = search != 'yahoo' ? 'q' : 'p';\n      let ret: any = {};\n\n      if (search !== null) {\n        ret['$search_engine'] = search;\n\n        var keyword = getQueryParam(referrer, param);\n        if (keyword.length) {\n          ret['ph_keyword'] = keyword;\n        }\n      }\n\n      return ret;\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include key words used in later checks.\n     */\n    browser: function (user_agent: any, vendor: any, opera: any) {\n      vendor = vendor || ''; // vendor is undefined for at least IE9\n      if (opera || includes(user_agent, ' OPR/')) {\n        if (includes(user_agent, 'Mini')) {\n          return 'Opera Mini';\n        }\n        return 'Opera';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n        return 'BlackBerry';\n      } else if (\n        includes(user_agent, 'IEMobile') ||\n        includes(user_agent, 'WPDesktop')\n      ) {\n        return 'Internet Explorer Mobile';\n      } else if (includes(user_agent, 'SamsungBrowser/')) {\n        // https://developer.samsung.com/internet/user-agent-string-format\n        return 'Samsung Internet';\n      } else if (includes(user_agent, 'Edge') || includes(user_agent, 'Edg/')) {\n        return 'Microsoft Edge';\n      } else if (includes(user_agent, 'FBIOS')) {\n        return 'Facebook Mobile';\n      } else if (includes(user_agent, 'Chrome')) {\n        return 'Chrome';\n      } else if (includes(user_agent, 'CriOS')) {\n        return 'Chrome iOS';\n      } else if (\n        includes(user_agent, 'UCWEB') ||\n        includes(user_agent, 'UCBrowser')\n      ) {\n        return 'UC Browser';\n      } else if (includes(user_agent, 'FxiOS')) {\n        return 'Firefox iOS';\n      } else if (includes(vendor, 'Apple')) {\n        if (includes(user_agent, 'Mobile')) {\n          return 'Mobile Safari';\n        }\n        return 'Safari';\n      } else if (includes(user_agent, 'Android')) {\n        return 'Android Mobile';\n      } else if (includes(user_agent, 'Konqueror')) {\n        return 'Konqueror';\n      } else if (includes(user_agent, 'Firefox')) {\n        return 'Firefox';\n      } else if (\n        includes(user_agent, 'MSIE') ||\n        includes(user_agent, 'Trident/')\n      ) {\n        return 'Internet Explorer';\n      } else if (includes(user_agent, 'Gecko')) {\n        return 'Mozilla';\n      } else {\n        return '';\n      }\n    },\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     */\n    browserVersion: function (userAgent: any, vendor: any, opera: any) {\n      const browser = info.browser(userAgent, vendor, opera);\n      const versionRegexs: {[key: string]: RegExp} = {\n        'Internet Explorer Mobile': /rv:(\\d+(\\.\\d+)?)/,\n        'Microsoft Edge': /Edge?\\/(\\d+(\\.\\d+)?)/,\n        Chrome: /Chrome\\/(\\d+(\\.\\d+)?)/,\n        'Chrome iOS': /CriOS\\/(\\d+(\\.\\d+)?)/,\n        'UC Browser': /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n        Safari: /Version\\/(\\d+(\\.\\d+)?)/,\n        'Mobile Safari': /Version\\/(\\d+(\\.\\d+)?)/,\n        Opera: /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n        Firefox: /Firefox\\/(\\d+(\\.\\d+)?)/,\n        'Firefox iOS': /FxiOS\\/(\\d+(\\.\\d+)?)/,\n        Konqueror: /Konqueror:(\\d+(\\.\\d+)?)/,\n        BlackBerry: /BlackBerry (\\d+(\\.\\d+)?)/,\n        'Android Mobile': /android\\s(\\d+(\\.\\d+)?)/,\n        'Samsung Internet': /SamsungBrowser\\/(\\d+(\\.\\d+)?)/,\n        'Internet Explorer': /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n        Mozilla: /rv:(\\d+(\\.\\d+)?)/,\n      };\n      const regex = versionRegexs[browser];\n      if (regex === undefined) {\n        return null;\n      }\n      const matches = userAgent.match(regex);\n      if (!matches) {\n        return null;\n      }\n\n      return parseFloat(matches[matches.length - 2]);\n    },\n\n    os: function () {\n      const a = userAgent;\n      if (/Windows/i.test(a)) {\n        if (/Phone/.test(a) || /WPDesktop/.test(a)) {\n          return 'Windows Phone';\n        }\n        return 'Windows';\n      } else if (/(iPhone|iPad|iPod)/.test(a)) {\n        return 'iOS';\n      } else if (/Android/.test(a)) {\n        return 'Android';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n        return 'BlackBerry';\n      } else if (/Mac/i.test(a)) {\n        return 'Mac OS X';\n      } else if (/Linux/.test(a)) {\n        return 'Linux';\n      } else if (/CrOS/.test(a)) {\n        return 'Chrome OS';\n      } else {\n        return '';\n      }\n    },\n\n    device: function (user_agent: any) {\n      if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n        return 'Windows Phone';\n      } else if (/iPad/.test(user_agent)) {\n        return 'iPad';\n      } else if (/iPod/.test(user_agent)) {\n        return 'iPod Touch';\n      } else if (/iPhone/.test(user_agent)) {\n        return 'iPhone';\n      } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n        return 'BlackBerry';\n      } else if (/Android/.test(user_agent)) {\n        return 'Android';\n      } else {\n        return '';\n      }\n    },\n\n    referringDomain: function (referrer: string) {\n      const split = referrer.split('/');\n      if (split.length >= 3) {\n        return split[2];\n      }\n      return '';\n    },\n\n    timezone: function (intl: any) {\n      try {\n        return intl.DateTimeFormat().resolvedOptions().timeZone;\n      } catch (e) {\n        return null;\n      }\n    },\n\n    properties: function () {\n      return extend(\n        stripEmptyProperties({\n          os: info.os(),\n          browser: info.browser(userAgent, navigator.vendor, windowOpera),\n          referrer: document.referrer,\n          referring_domain: info.referringDomain(document.referrer),\n          device: info.device(userAgent),\n          time_zone: info.timezone(intl),\n        }),\n        {\n          current_url: win.location.href,\n          host: win.location.host,\n          pathname: win.location.pathname,\n          browser_version: info\n            .browserVersion(userAgent, navigator.vendor, windowOpera)\n            ?.toString(),\n          screen_height: screen.height,\n          screen_width: screen.width,\n          lib: 'web',\n          insert_id:\n            Math.random().toString(36).substring(2, 10) +\n            Math.random().toString(36).substring(2, 10),\n          time: timestamp() / 1000, // epoch time in seconds\n        }\n      );\n    },\n  };\n\n  return info.properties();\n}\n","export const helpers = (win: any) => {\n  const ArrayProto = Array.prototype;\n  const FuncProto = Function.prototype;\n  const ObjProto = Object.prototype;\n  const toString = ObjProto.toString;\n  const hasOwnProperty = ObjProto.hasOwnProperty;\n  const windowConsole = win.console;\n  const navigator = win.navigator;\n  const document = win.document;\n  const windowOpera = (win as any).opera;\n  const screen = win.screen;\n  const userAgent = navigator.userAgent;\n  const intl = win.Intl;\n\n  const nativeBind = FuncProto.bind;\n  const nativeForEach = ArrayProto.forEach;\n  const nativeIndexOf = ArrayProto.indexOf;\n  const nativeIsArray = Array.isArray;\n  const slice = ArrayProto.slice;\n  const breaker = {};\n\n  const __NOOP = function () {};\n  const __NOOPTIONS = {};\n\n  const isArray =\n    nativeIsArray ||\n    function (obj: any) {\n      return toString.call(obj) === '[object Array]';\n    };\n\n  function isObject(obj: any) {\n    return obj === Object(obj) && !isArray(obj);\n  }\n\n  function isFunction(f: any) {\n    try {\n      return /^\\s*\\bfunction\\b/.test(f);\n    } catch (x) {\n      return false;\n    }\n  }\n\n  function isString(obj: any) {\n    return toString.call(obj) == '[object String]';\n  }\n\n  function includes(str: any, needle: any) {\n    return str.indexOf(needle) !== -1;\n  }\n\n  function isUndefined(obj: any) {\n    return obj === void 0;\n  }\n\n  function timestamp() {\n    Date.now =\n      Date.now ||\n      function () {\n        return +new Date();\n      };\n\n    return Date.now();\n  }\n\n  function each(obj: any, iterator: any, context?: any) {\n    if (obj === null || obj === undefined) {\n      return;\n    }\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n          return;\n        }\n      }\n    } else {\n      for (var key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) {\n            return;\n          }\n        }\n      }\n    }\n  }\n\n  function trim(str: string) {\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n  }\n\n  function extend(obj: any, ...args: Array<any>) {\n    each(args, function (source: any) {\n      for (let prop in source) {\n        if (source[prop] !== void 0) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n\n    return obj;\n  }\n\n  function bind(func: any, context: any) {\n    let args: any;\n    let bound: any;\n\n    if (nativeBind && func.bind === nativeBind) {\n      return nativeBind.apply(func, slice.call(arguments, 1));\n    }\n    if (!isFunction(func)) {\n      throw new TypeError();\n    }\n    args = slice.call(arguments, 2);\n    bound = function () {\n      if (!(this instanceof bound)) {\n        return func.apply(context, args.concat(slice.call(arguments)));\n      }\n      let ctor: any = {};\n      ctor.prototype = func.prototype;\n      let self = new ctor();\n      ctor.prototype = null;\n      let result = func.apply(self, args.concat(slice.call(arguments)));\n      if (Object(result) === result) {\n        return result;\n      }\n      return self;\n    };\n    return bound;\n  }\n\n  function truncate(obj: any, length: number) {\n    let ret: any;\n\n    if (typeof obj === 'string') {\n      ret = obj.slice(0, length);\n    } else if (isArray(obj)) {\n      ret = [];\n      each(obj, function (val: any) {\n        ret.push(truncate(val, length));\n      });\n    } else if (isObject(obj)) {\n      ret = {};\n      each(obj, function (val: any, key: string) {\n        ret[key] = truncate(val, length);\n      });\n    } else {\n      ret = obj;\n    }\n\n    return ret;\n  }\n\n  function stripEmptyProperties(obj: any) {\n    let ret: any = {};\n\n    each(obj, function (v: any, k: string) {\n      if (isString(v) && v.length > 0) {\n        ret[k] = v;\n      }\n    });\n\n    return ret;\n  }\n\n  function HTTPBuildQuery(formdata: any, arg_separator?: any) {\n    let use_val;\n    let use_key;\n    let arr: Array<any> = [];\n\n    if (isUndefined(arg_separator)) {\n      arg_separator = '&';\n    }\n\n    each(formdata, function (val: any, key: string) {\n      use_val = encodeURIComponent(val.toString());\n      use_key = encodeURIComponent(key);\n      arr[arr.length] = use_key + '=' + use_val;\n    });\n\n    return arr.join(arg_separator);\n  }\n\n  const JSONEncode = (function () {\n    return function (mixed_val: any) {\n      var value = mixed_val;\n      var quote = function (string: string) {\n        var escapable = /[\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g; // eslint-disable-line no-control-regex\n        var meta: any = {\n          // table of character substitutions\n          '\\b': '\\\\b',\n          '\\t': '\\\\t',\n          '\\n': '\\\\n',\n          '\\f': '\\\\f',\n          '\\r': '\\\\r',\n          '\"': '\\\\\"',\n          '\\\\': '\\\\\\\\',\n        };\n\n        escapable.lastIndex = 0;\n        return escapable.test(string)\n          ? '\"' +\n              string.replace(escapable, function (a) {\n                var c = meta[a];\n                return typeof c === 'string'\n                  ? c\n                  : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n              }) +\n              '\"'\n          : '\"' + string + '\"';\n      };\n\n      var str = function (key: any, holder: any) {\n        let gap = '';\n        let indent = '    ';\n        let i = 0; // The loop counter.\n        let k = ''; // The member key.\n        let v: any = ''; // The member value.\n        let length = 0;\n        let mind = gap;\n        let partial = [];\n        let value = holder[key];\n\n        // If the value has a toJSON method, call it to obtain a replacement value.\n        if (\n          value &&\n          typeof value === 'object' &&\n          typeof value.toJSON === 'function'\n        ) {\n          value = value.toJSON(key);\n        }\n\n        // What happens next depends on the value's type.\n        switch (typeof value) {\n          case 'string':\n            return quote(value);\n\n          case 'number':\n            // JSON numbers must be finite. Encode non-finite numbers as null.\n            return isFinite(value) ? String(value) : 'null';\n          case 'boolean':\n          case 'undefined':\n            // case 'null':\n            // If the value is a boolean or null, convert it to a string. Note:\n            // typeof null does not produce 'null'. The case is included here in\n            // the remote chance that this gets fixed someday.\n\n            return String(value);\n          case 'object':\n            // If the type is 'object', we might be dealing with an object or an array or\n            // null.\n            // Due to a specification blunder in ECMAScript, typeof null is 'object',\n            // so watch out for that case.\n            if (!value) {\n              return 'null';\n            }\n\n            // Make an array to hold the partial results of stringifying this object value.\n            gap += indent;\n            partial = [];\n\n            // Is the value an array?\n            if (toString.apply(value) === '[object Array]') {\n              // The value is an array. Stringify every element. Use null as a placeholder\n              // for non-JSON values.\n\n              length = value.length;\n              for (i = 0; i < length; i += 1) {\n                partial[i] = str(i, value) || 'null';\n              }\n\n              // Join all of the elements together, separated with commas, and wrap them in\n              // brackets.\n              v =\n                partial.length === 0\n                  ? '[]'\n                  : gap\n                  ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                  : '[' + partial.join(',') + ']';\n              gap = mind;\n              return v;\n            }\n\n            // Iterate through all of the keys in the object.\n            for (k in value) {\n              if (hasOwnProperty.call(value, k)) {\n                v = str(k, value);\n                if (v) {\n                  partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                }\n              }\n            }\n\n            // Join all of the member texts together, separated with commas,\n            // and wrap them in braces.\n            v =\n              partial.length === 0\n                ? '{}'\n                : gap\n                ? '{' + partial.join(',') + '' + mind + '}'\n                : '{' + partial.join(',') + '}';\n            gap = mind;\n            return v;\n        }\n      };\n\n      // Make a fake root object containing our value under the key of ''.\n      // Return the result of stringifying the value.\n      return str('', {\n        '': value,\n      });\n    };\n  })();\n\n  const JSONDecode = (function () {\n    let at: any; // The index of the current character\n    let ch: any; // The current character\n    let escapee: any = {\n      '\"': '\"',\n      '\\\\': '\\\\',\n      '/': '/',\n      b: '\\b',\n      f: '\\f',\n      n: '\\n',\n      r: '\\r',\n      t: '\\t',\n    };\n    let text: string;\n    let error = function (m: string) {\n      var e: any = new SyntaxError(m);\n      e.at = at;\n      e.text = text;\n      throw e;\n    };\n    let next = function (c?: any) {\n      // If a c parameter is provided, verify that it matches the current character.\n      if (c && c !== ch) {\n        error(\"Expected '\" + c + \"' instead of '\" + ch + \"'\");\n      }\n      // Get the next character. When there are no more characters,\n      // return the empty string.\n      ch = text.charAt(at);\n      at += 1;\n      return ch;\n    };\n    let number = function () {\n      // Parse a number value.\n      var number,\n        string = '';\n\n      if (ch === '-') {\n        string = '-';\n        next('-');\n      }\n      while (ch >= '0' && ch <= '9') {\n        string += ch;\n        next();\n      }\n      if (ch === '.') {\n        string += '.';\n        while (next() && ch >= '0' && ch <= '9') {\n          string += ch;\n        }\n      }\n      if (ch === 'e' || ch === 'E') {\n        string += ch;\n        next();\n        if (ch === '-' || ch === '+') {\n          string += ch;\n          next();\n        }\n        while (ch >= '0' && ch <= '9') {\n          string += ch;\n          next();\n        }\n      }\n      number = +string;\n      if (!isFinite(number)) {\n        error('Bad number');\n      } else {\n        return number;\n      }\n    };\n    let string = function () {\n      // Parse a string value.\n      let hex;\n      let i;\n      let string = '';\n      let uffff;\n\n      // When parsing for string values, we must look for \" and \\ characters.\n      if (ch === '\"') {\n        while (next()) {\n          if (ch === '\"') {\n            next();\n            return string;\n          }\n          if (ch === '\\\\') {\n            next();\n            if (ch === 'u') {\n              uffff = 0;\n              for (i = 0; i < 4; i += 1) {\n                hex = parseInt(next(), 16);\n                if (!isFinite(hex)) {\n                  break;\n                }\n                uffff = uffff * 16 + hex;\n              }\n              string += String.fromCharCode(uffff);\n            } else if (typeof escapee[ch] === 'string') {\n              string += escapee[ch];\n            } else {\n              break;\n            }\n          } else {\n            string += ch;\n          }\n        }\n      }\n      error('Bad string');\n    };\n    let white = function () {\n      // Skip whitespace.\n      while (ch && ch <= ' ') {\n        next();\n      }\n    };\n    let word = function () {\n      // true, false, or null.\n      switch (ch) {\n        case 't':\n          next('t');\n          next('r');\n          next('u');\n          next('e');\n          return true;\n        case 'f':\n          next('f');\n          next('a');\n          next('l');\n          next('s');\n          next('e');\n          return false;\n        case 'n':\n          next('n');\n          next('u');\n          next('l');\n          next('l');\n          return null;\n      }\n      error('Unexpected \"' + ch + '\"');\n    };\n    let value: any; // Placeholder for the value function.\n    let array = function () {\n      // Parse an array value.\n      var array: Array<any> = [];\n\n      if (ch === '[') {\n        next('[');\n        white();\n        if (ch === ']') {\n          next(']');\n          return array; // empty array\n        }\n        while (ch) {\n          array.push(value());\n          white();\n          if (ch === ']') {\n            next(']');\n            return array;\n          }\n          next(',');\n          white();\n        }\n      }\n      error('Bad array');\n    };\n    let object = function () {\n      // Parse an object value.\n      let key: any;\n      let object: any = {};\n\n      if (ch === '{') {\n        next('{');\n        white();\n        if (ch === '}') {\n          next('}');\n          return object; // empty object\n        }\n        while (ch) {\n          key = string();\n          white();\n          next(':');\n          if (Object.hasOwnProperty.call(object, key)) {\n            error('Duplicate key \"' + key + '\"');\n          }\n          object[key] = value();\n          white();\n          if (ch === '}') {\n            next('}');\n            return object;\n          }\n          next(',');\n          white();\n        }\n      }\n      error('Bad object');\n    };\n\n    value = function () {\n      // Parse a JSON value. It could be an object, an array, a string,\n      // a number, or a word.\n      white();\n      switch (ch) {\n        case '{':\n          return object();\n        case '[':\n          return array();\n        case '\"':\n          return string();\n        case '-':\n          return number();\n        default:\n          return ch >= '0' && ch <= '9' ? number() : word();\n      }\n    };\n\n    // Return the json_parse function. It will have access to all of the\n    // above functions and variables.\n    return function (source: any) {\n      var result;\n\n      text = source;\n      at = 0;\n      ch = ' ';\n      result = value();\n      white();\n      if (ch) {\n        error('Syntax error');\n      }\n\n      return result;\n    };\n  })();\n\n  function utf8Encode(string: string) {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n    var utftext = '',\n      start,\n      end;\n    var stringl = 0,\n      n;\n\n    start = end = 0;\n    stringl = string.length;\n\n    for (n = 0; n < stringl; n++) {\n      var c1 = string.charCodeAt(n);\n      var enc = null;\n\n      if (c1 < 128) {\n        end++;\n      } else if (c1 > 127 && c1 < 2048) {\n        enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128);\n      } else {\n        enc = String.fromCharCode(\n          (c1 >> 12) | 224,\n          ((c1 >> 6) & 63) | 128,\n          (c1 & 63) | 128\n        );\n      }\n      if (enc !== null) {\n        if (end > start) {\n          utftext += string.substring(start, end);\n        }\n        utftext += enc;\n        start = end = n + 1;\n      }\n    }\n\n    if (end > start) {\n      utftext += string.substring(start, string.length);\n    }\n\n    return utftext;\n  }\n\n  function base64Encode(data: any) {\n    var b64 =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    var o1,\n      o2,\n      o3,\n      h1,\n      h2,\n      h3,\n      h4,\n      bits,\n      i = 0,\n      ac = 0,\n      enc = '',\n      tmp_arr = [];\n\n    if (!data) {\n      return data;\n    }\n\n    data = utf8Encode(data);\n\n    do {\n      // pack three octets into four hexets\n      o1 = data.charCodeAt(i++);\n      o2 = data.charCodeAt(i++);\n      o3 = data.charCodeAt(i++);\n\n      bits = (o1 << 16) | (o2 << 8) | o3;\n\n      h1 = (bits >> 18) & 0x3f;\n      h2 = (bits >> 12) & 0x3f;\n      h3 = (bits >> 6) & 0x3f;\n      h4 = bits & 0x3f;\n\n      // use hexets to index into b64, and append result to encoded string\n      tmp_arr[ac++] =\n        b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n      case 1:\n        enc = enc.slice(0, -2) + '==';\n        break;\n      case 2:\n        enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n  }\n\n  function getQueryParam(url: string, param: string) {\n    // Expects a raw URL\n    param = param.replace(/[[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n\n    const regexS = '[\\\\?&]' + param + '=([^&#]*)';\n    const regex = new RegExp(regexS);\n    const results = regex.exec(url);\n\n    if (\n      results === null ||\n      (results && typeof results[1] !== 'string' && (results[1] as any).length)\n    ) {\n      return '';\n    } else {\n      var result = results[1];\n      try {\n        result = decodeURIComponent(result);\n      } catch (err) {\n        console.error('Skipping decoding for malformed query param: ' + result);\n      }\n      return result.replace(/\\+/g, ' ');\n    }\n  }\n\n  return {\n    ArrayProto,\n    FuncProto,\n    ObjProto,\n    toString,\n    hasOwnProperty,\n    win,\n    windowConsole,\n    navigator,\n    document,\n    windowOpera,\n    screen,\n    userAgent,\n    intl,\n    nativeBind,\n    nativeForEach,\n    nativeIndexOf,\n    nativeIsArray,\n    slice,\n    breaker,\n    __NOOP,\n    __NOOPTIONS,\n    isFunction,\n    isString,\n    includes,\n    isUndefined,\n    timestamp,\n    each,\n    trim,\n    extend,\n    bind,\n    truncate,\n    stripEmptyProperties,\n    HTTPBuildQuery,\n    JSONEncode,\n    JSONDecode,\n    utf8Encode,\n    base64Encode,\n    getQueryParam,\n  };\n};\n","import React from 'react';\nimport {Presence} from 'phoenix';\nimport styled from '@emotion/styled';\nimport {isAgentMessage, Papercups} from '@papercups-io/browser';\n\nimport PapercupsBranding from './PapercupsBranding';\nimport {\n  noop,\n  isCustomerMessage,\n  shorten,\n  setupCustomEventHandlers,\n} from '../helpers/utils';\nimport {\n  CustomerMetadata,\n  Message,\n  WidgetConfig,\n  WidgetSettings,\n} from '../helpers/types';\nimport {isDev} from '../helpers/config';\nimport Logger from '../helpers/logger';\nimport {\n  addVisibilityEventListener,\n  isWindowHidden,\n} from '../helpers/visibility';\nimport {getUserInfo} from '../track/info';\n\nconst Box = styled.div``;\n\nconst Flex = styled.div`\n  display: flex;\n`;\n\nconst ChatWindowContainer = styled.div(({isOpen}: {isOpen?: boolean}) => ({\n  margin: 0,\n  zIndex: 2147483000,\n  position: 'fixed',\n  bottom: 100,\n  right: 20,\n  width: 376,\n  maxWidth: ['90%', '376px'],\n  minHeight: isOpen ? 250 : 0,\n  maxHeight: ['60%', '704px'],\n  background: '#fff',\n  boxShadow: 'rgba(0, 0, 0, 0.16) 0px 5px 40px',\n  height: isOpen ? 'calc(100% - 120px)' : 0,\n  border: 'none',\n  borderRadius: 8,\n  overflow: 'hidden',\n  transition: 'opacity 0.2s ease-in, transform 0.2s ease-in',\n  opacity: isOpen ? 1 : 0,\n  transform: isOpen ? 'none' : 'translateY(4px) translateZ(0px)',\n  pointerEvents: isOpen ? 'auto' : 'none',\n}));\n\nconst NotificationsContainer = styled.div(({isOpen}: {isOpen?: boolean}) => ({\n  margin: 0,\n  zIndex: 2147483000,\n  position: 'fixed',\n  bottom: 100,\n  right: 20,\n  width: 240,\n  maxWidth: ['90%', '376px'],\n  minHeight: isOpen ? 250 : 0,\n  maxHeight: ['60%', '704px'],\n  background: 'transparent',\n  boxShadow: 'none',\n  height: isOpen ? 'calc(100% - 120px)' : 0,\n  border: 'none',\n  borderRadius: 8,\n  overflow: 'hidden',\n  transition: 'opacity 0.2s ease-in, transform 0.2s ease-in',\n  opacity: isOpen ? 1 : 0,\n  transform: isOpen ? 'none' : 'translateY(4px) translateZ(0px)',\n  pointerEvents: isOpen ? 'auto' : 'none',\n}));\n\nconst ToggleButtonContainer = styled.div({\n  position: 'fixed',\n  zIndex: 2147483003,\n  bottom: 20,\n  right: 20,\n});\n\nexport type Config = {\n  accountId: string;\n  customerId?: string;\n  primaryColor?: string;\n  title?: string;\n  subtitle?: string;\n  baseUrl?: string;\n  greeting?: string;\n  awayMessage?: string;\n  newMessagePlaceholder?: string;\n  emailInputPlaceholder?: string;\n  newMessagesNotificationText?: string;\n  shouldRequireEmail?: boolean;\n  isMobile?: boolean;\n  customer?: CustomerMetadata;\n  companyName?: string;\n  agentAvailableText?: string;\n  agentUnavailableText?: string;\n  showAgentAvailability?: boolean;\n  isCloseable?: boolean;\n};\n\nexport interface Options {\n  config: Config;\n  state: State;\n}\n\nexport type OnSendMessage = (\n  message: Partial<Message>,\n  email?: string\n) => Promise<any>;\nexport type ScrollToRef = (el: any) => void;\nexport type HeaderProps = Options & {onClose: () => void};\nexport type BodyProps = Options & {scrollToRef: ScrollToRef};\nexport type FooterProps = Options & {\n  onSendMessage: OnSendMessage;\n};\nexport type ToggleButtonProps = Options & {onToggleOpen: () => void};\nexport type NotificationsProps = Options & {\n  unread: Array<Message>;\n  onToggleOpen: () => void;\n};\n\nexport type ChildrenProps = Options & {\n  onClose: () => void;\n  onSendMessage: OnSendMessage;\n  onToggleOpen: () => void;\n  scrollToRef: ScrollToRef;\n};\n\ntype Props = {\n  config: Config;\n  debug?: boolean;\n  isOpenByDefault?: boolean;\n  scrollIntoViewOptions?: boolean | ScrollIntoViewOptions;\n  styles?: {\n    header?: Record<string, any>;\n    body?: Record<string, any>;\n    footer?: Record<string, any>;\n  };\n  // TODO: figure out what type this should be\n  children?: (options: ChildrenProps) => React.ReactElement;\n  // UI components\n  header?: (options: HeaderProps) => React.ReactElement;\n  body?: (options: BodyProps) => React.ReactElement;\n  footer?: (options: FooterProps) => React.ReactElement;\n  toggle?: (options: ToggleButtonProps) => React.ReactElement;\n  notifications?: (options: NotificationsProps) => React.ReactElement;\n  // callbacks\n  onChatLoaded?: (papercups: Papercups) => void;\n  onChatOpened?: () => void;\n  onChatClosed?: () => void;\n  onMessageSent?: (message: Message) => void;\n  onMessageReceived?: (message: Message) => void;\n};\n\nexport type State = {\n  config: WidgetConfig;\n  messages: Array<Message>;\n  customerId?: string | null;\n  conversationId: string | null;\n  availableAgents: Array<any>;\n  isLoaded: boolean;\n  isSending: boolean;\n  isOpen: boolean;\n  shouldDisplayNotifications: boolean;\n  shouldDisplayBranding: boolean;\n};\n\nclass ChatBuilder extends React.Component<Props, State> {\n  scrollToEl: any = null;\n\n  logger: Logger;\n  subscriptions: Array<() => void> = [];\n\n  papercups: Papercups;\n\n  EVENTS = [\n    'papercups:open',\n    'papercups:close',\n    'papercups:toggle',\n    'papercups:identify',\n    'storytime:customer:set',\n  ];\n\n  constructor(props: Props) {\n    super(props);\n\n    const {children, isOpenByDefault} = props;\n    const isOpen = typeof children === 'function' || !!isOpenByDefault;\n\n    this.state = {\n      config: {} as WidgetConfig,\n      messages: [],\n      // TODO: figure out how to determine these, either by IP or localStorage\n      // (eventually we will probably use cookies for this)\n      // TODO: remove this from state if possible, just use props instead?\n      customerId: null,\n      availableAgents: [],\n      conversationId: null,\n      isLoaded: false,\n      isSending: false,\n      isOpen: isOpen,\n      shouldDisplayNotifications: false,\n      shouldDisplayBranding: true,\n    };\n  }\n\n  async componentDidMount() {\n    const win = window as any;\n    const doc = (document || win.document) as any;\n    const debugModeEnabled = isDev(win) || !!this.props.debug;\n\n    this.papercups = Papercups.init({\n      customerId: this.props.config.customerId,\n      accountId: this.props.config.accountId,\n      baseUrl: this.props.config.baseUrl,\n      customer: this.props.config.customer,\n      greeting: this.props.config.greeting,\n      awayMessage: this.props.config.awayMessage,\n      debug: this.props.debug,\n      onPresenceSync: this.onPresenceSync,\n      onSetCustomerId: this.onSetCustomerId,\n      onSetConversationId: this.onSetConversationId,\n      onSetWidgetSettings: this.onWidgetSettingsLoaded,\n      onMessagesUpdated: this.onMessagesUpdated,\n      onConversationCreated: this.onConversationCreated,\n      onMessageCreated: this.handleNewMessage,\n    });\n\n    this.logger = new Logger(debugModeEnabled);\n    this.subscriptions = [\n      setupCustomEventHandlers(window, this.EVENTS, this.customEventHandlers),\n      addVisibilityEventListener(doc, this.handleVisibilityChange),\n    ];\n\n    await this.papercups.start();\n\n    this.handleChatLoaded();\n  }\n\n  componentWillUnmount() {\n    this.papercups.disconnect();\n    this.subscriptions.forEach((unsubscribe) => {\n      if (typeof unsubscribe === 'function') {\n        unsubscribe();\n      }\n    });\n  }\n\n  onWidgetSettingsLoaded = (settings: WidgetSettings) => {\n    const {\n      accountId,\n      primaryColor,\n      baseUrl,\n      title,\n      subtitle,\n      greeting,\n      newMessagePlaceholder,\n      emailInputPlaceholder,\n      newMessagesNotificationText,\n      agentAvailableText,\n      agentUnavailableText,\n      showAgentAvailability,\n      // requireEmailUpfront,\n      // canToggle,\n      customer = {},\n    } = this.props.config;\n\n    const metadata = {...getUserInfo(window), ...customer};\n    const config: WidgetConfig = {\n      accountId,\n      baseUrl,\n      agentAvailableText,\n      agentUnavailableText,\n      title: title || settings.title,\n      subtitle: subtitle || settings.subtitle,\n      primaryColor: primaryColor || settings.color,\n      greeting: greeting || settings.greeting,\n      newMessagePlaceholder:\n        newMessagePlaceholder || settings.new_message_placeholder,\n      emailInputPlaceholder:\n        emailInputPlaceholder || settings.email_input_placeholder,\n      newMessagesNotificationText:\n        newMessagesNotificationText || settings.new_messages_notification_text,\n      companyName: settings?.account?.company_name,\n      // requireEmailUpfront: requireEmailUpfront ? 1 : 0,\n      showAgentAvailability:\n        showAgentAvailability || settings.show_agent_availability,\n      // closeable: canToggle ? 1 : 0,\n      customerId: this.papercups.getCachedCustomerId(),\n      subscriptionPlan: settings?.account?.subscription_plan,\n      metadata: metadata,\n    };\n\n    this.setState({config});\n    // Set some metadata on the widget to better understand usage\n    this.papercups.updateWidgetSettingsMetadata(metadata);\n  };\n\n  customEventHandlers = (event: any) => {\n    if (!event || !event.type) {\n      return null;\n    }\n\n    const {type, detail} = event;\n\n    switch (type) {\n      case 'papercups:open':\n        return this.setOpenState(true);\n      case 'papercups:close':\n        return this.setOpenState(false);\n      case 'papercups:toggle':\n        return this.handleToggleOpen();\n      case 'storytime:customer:set':\n        return console.warn(\n          'No handler has been set up to handle event `storytime:customer:set`',\n          detail\n        );\n      default:\n        return null;\n    }\n  };\n\n  setOpenState = (isOpen: boolean) => {\n    // TODO: execute toggle callbacks\n    this.setState({isOpen}, () => {\n      this.handleVisibilityChange();\n\n      if (isOpen) {\n        this.scrollIntoView();\n      }\n    });\n  };\n\n  handleToggleOpen = () => {\n    const {isOpen: wasOpen, isLoaded} = this.state;\n    const isOpen = !wasOpen;\n\n    // Prevent opening the widget until everything has loaded\n    if (!isLoaded) {\n      return;\n    }\n\n    this.setOpenState(isOpen);\n  };\n\n  handleChatLoaded = () => {\n    this.setState({isLoaded: true});\n\n    const {onChatLoaded = noop} = this.props;\n\n    if (onChatLoaded && typeof onChatLoaded === 'function') {\n      onChatLoaded(this.papercups);\n    }\n  };\n\n  handleNewMessageCallbacks = (message: Message) => {\n    const {onMessageReceived = noop, onMessageSent = noop} = this.props;\n\n    if (isAgentMessage(message)) {\n      onMessageReceived && onMessageReceived(message);\n    } else {\n      onMessageSent && onMessageSent(message);\n    }\n  };\n\n  onSetCustomerId = (customerId: string) => {\n    this.logger.debug('Setting customer ID:', customerId);\n\n    this.setState({customerId});\n\n    if (!customerId) {\n      return;\n    }\n\n    const customerBrowserInfo = getUserInfo(window);\n    const metadata = {\n      ...customerBrowserInfo,\n      ...this.papercups.formatCustomerMetadata(),\n    };\n\n    this.papercups.updateExistingCustomer(customerId, metadata);\n  };\n\n  onSetConversationId = (conversationId: string) => {\n    this.setState({conversationId});\n  };\n\n  onConversationCreated = (customerId: string, data: any) => {\n    // Handle conversation created event\n    this.logger.debug('Conversation created:', {customerId, data});\n  };\n\n  onMessagesUpdated = (messages: Array<Message>) => {\n    this.setState({messages}, () => this.scrollIntoView());\n\n    const unseenMessages = messages.filter(\n      (msg: Message) => !msg.seen_at && !!msg.user_id\n    );\n\n    if (unseenMessages.length > 0) {\n      const [firstUnseenMessage] = unseenMessages;\n\n      this.handleUnseenMessages({message: firstUnseenMessage});\n    }\n  };\n\n  onPresenceSync = (presence: Presence) => {\n    this.logger.debug('Syncing presence:', presence.list());\n\n    this.setState({\n      availableAgents: presence\n        .list()\n        .map(({metas}) => {\n          const [info] = metas;\n\n          return info;\n        })\n        .filter((info) => !!info.user_id),\n    });\n  };\n\n  scrollIntoView = () => {\n    const {scrollIntoViewOptions = false} = this.props;\n\n    this.scrollToEl && this.scrollToEl.scrollIntoView(scrollIntoViewOptions);\n  };\n\n  handleUnseenMessages = (payload: any) => {\n    this.logger.debug('Handling unseen messages:', payload);\n    this.setState({shouldDisplayNotifications: true});\n  };\n\n  handleMessagesSeen = () => {\n    this.logger.debug('Handling messages seen');\n    this.setState({shouldDisplayNotifications: false});\n  };\n\n  // If the page is not visible (i.e. user is looking at another tab),\n  // we want to mark messages as read once the chat widget becomes visible\n  // again, as long as it's open.\n  handleVisibilityChange = (e?: any) => {\n    const doc = document || (e && e.target);\n\n    if (isWindowHidden(doc)) {\n      return;\n    }\n\n    const {messages = []} = this.state;\n    const shouldMarkSeen = messages.some((msg) => this.shouldMarkAsSeen(msg));\n\n    if (shouldMarkSeen) {\n      this.markMessagesAsSeen();\n    }\n  };\n\n  handlePapercupsPlan = (payload: any = {}) => {\n    this.logger.debug('Handling subscription plan:', payload);\n\n    // TODO: figure out the best way to determine when to display branding\n    // const plan = payload && payload.plan;\n    // const shouldDisplayBranding = plan\n    //   ? String(plan).toLowerCase() === 'starter'\n    //   : false;\n\n    this.setState({shouldDisplayBranding: true});\n  };\n\n  // TODO: how is this different than `handleToggleOpen`?\n  handleToggleDisplay = (payload: any = {}) => {\n    const isOpen = !!payload.isOpen;\n\n    this.setState({isOpen}, () => {\n      this.handleVisibilityChange();\n\n      if (isOpen) {\n        this.scrollIntoView();\n      }\n    });\n  };\n\n  handleNewMessage = (message: Message) => {\n    this.handleNewMessageCallbacks(message);\n\n    if (this.shouldMarkAsSeen(message)) {\n      this.markMessagesAsSeen();\n    }\n  };\n\n  shouldMarkAsSeen = (message: Message) => {\n    const {isOpen} = this.state;\n    const {seen_at: seenAt} = message;\n\n    // If already seen or the page is not visible, don't mark as seen\n    if (seenAt || isWindowHidden(document)) {\n      return false;\n    }\n\n    return isAgentMessage(message) && isOpen;\n  };\n\n  markMessagesAsSeen = () => {\n    this.papercups.markMessagesAsSeen();\n    this.handleMessagesSeen();\n  };\n\n  handleSendMessage = async (message: Partial<Message>, email?: string) => {\n    this.papercups.sendNewMessage(message, email);\n  };\n\n  // TODO: make it possible to disable this feature?\n  renderUnreadMessages() {\n    const MAX_CHARS = 140;\n    const {notifications} = this.props;\n\n    if (!notifications || typeof notifications !== 'function') {\n      return null;\n    }\n\n    const {customerId, messages = []} = this.state;\n    const unread = messages\n      .filter((msg) => {\n        const {seen_at: seen, body} = msg;\n\n        if (seen) {\n          return false;\n        }\n\n        // NB: `msg.type` doesn't come from the server, it's just a way to\n        // help identify unsent messages in the frontend for now\n        const isMe = isCustomerMessage(msg, customerId);\n\n        return !isMe && body && body.trim().length > 0;\n      })\n      .slice(0, 2) // Only show the first 2 unread messages\n      .map((msg) => {\n        const {body = ''} = msg;\n\n        return {...msg, body: shorten(body, MAX_CHARS)};\n      });\n\n    if (unread.length === 0) {\n      return null;\n    }\n\n    // TODO: how should this be styled/positioned? (probably similar to toggle?)\n    return (\n      <NotificationsContainer isOpen>\n        <Flex\n          style={{\n            background: 'transparent',\n            flexDirection: 'column',\n            justifyContent: 'flex-end',\n            height: '100%',\n            width: '100%',\n            flex: 1,\n          }}\n        >\n          {notifications({\n            config: this.props.config,\n            state: this.state,\n            unread: unread,\n            onToggleOpen: this.handleToggleOpen,\n          })}\n        </Flex>\n      </NotificationsContainer>\n    );\n  }\n\n  render() {\n    const {config, styles = {}, children} = this.props;\n    const {\n      isOpen,\n      shouldDisplayNotifications,\n      shouldDisplayBranding,\n    } = this.state;\n\n    // TODO: set up a React context for this?\n    if (children) {\n      return children({\n        config: config,\n        state: this.state,\n        // TODO: dedupe?\n        onClose: this.handleToggleOpen,\n        onToggleOpen: this.handleToggleOpen,\n        onSendMessage: this.handleSendMessage,\n        scrollToRef: (el: any) => (this.scrollToEl = el),\n      });\n    }\n\n    return (\n      <React.Fragment>\n        {!isOpen && shouldDisplayNotifications && this.renderUnreadMessages()}\n\n        <ChatWindowContainer\n          className='Papercups-chatWindowContainer'\n          isOpen={isOpen}\n        >\n          <Flex\n            style={{\n              background: '#fff',\n              flexDirection: 'column',\n              height: '100%',\n              width: '100%',\n              flex: 1,\n            }}\n          >\n            {this.props.header &&\n              this.props.header({\n                config: config,\n                state: this.state,\n                onClose: this.handleToggleOpen,\n              })}\n\n            <Box\n              style={{\n                flex: 1,\n                overflowY: 'scroll',\n                // boxShadow: 'rgba(0, 0, 0, 0.2) 0px 21px 4px -20px inset',\n                ...styles.body,\n              }}\n            >\n              {this.props.body &&\n                this.props.body({\n                  config: config,\n                  state: this.state,\n                  scrollToRef: (el: any) => (this.scrollToEl = el),\n                })}\n            </Box>\n\n            {shouldDisplayBranding && <PapercupsBranding />}\n\n            {this.props.footer &&\n              this.props.footer({\n                config: config,\n                state: this.state,\n                onSendMessage: this.handleSendMessage,\n              })}\n\n            <img\n              alt='Papercups'\n              src='https://papercups.s3.us-east-2.amazonaws.com/papercups-logo.svg'\n              width='0'\n              height='0'\n            />\n          </Flex>\n        </ChatWindowContainer>\n\n        <ToggleButtonContainer className='Papercups-toggleButtonContainer'>\n          {this.props.toggle &&\n            this.props.toggle({\n              config: config,\n              state: this.state,\n              onToggleOpen: this.handleToggleOpen,\n            })}\n        </ToggleButtonContainer>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default ChatBuilder;\n","export const DEFAULT_BASE_URL = 'https://app.papercups.io';\n\nexport const isDev = (w: any) => {\n  return Boolean(\n    w.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      w.location.hostname === '[::1]' ||\n      // 127.0.0.0/8 are considered localhost for IPv4.\n      w.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n  );\n};\n\nexport const getWebsocketUrl = (baseUrl?: string) => {\n  // TODO: handle this parsing better\n  const url = baseUrl || DEFAULT_BASE_URL;\n  const [protocol, host] = url.split('://');\n  const isHttps = protocol === 'https';\n\n  // TODO: not sure how websockets work with subdomains\n  return `${isHttps ? 'wss' : 'ws'}://${host}/socket`;\n};\n","import React from 'react';\nimport {BodyProps} from './ChatBuilder';\n\nconst CustomerMessage = ({message, isNextSameSender}: any) => {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        paddingBottom: isNextSameSender ? 8 : 16,\n        paddingLeft: 48,\n        paddingRight: 0,\n        justifyContent: 'flex-end',\n      }}\n    >\n      <div\n        style={{\n          fontSize: 14,\n          borderRadius: 5,\n          padding: '12px 16px',\n          background: 'rgb(24, 144, 255)',\n          color: '#fff',\n          whiteSpace: 'pre-wrap',\n        }}\n      >\n        {message.body}\n      </div>\n    </div>\n  );\n};\n\nconst AgentMessage = ({message, isNextSameSender}: any) => {\n  const profilePhotoUrl =\n    message.user?.profile_photo_url ||\n    'https://avatars.slack-edge.com/2021-01-13/1619416452487_002cddd7d8aea1950018_192.png';\n  const shouldDisplayAvatar = !isNextSameSender;\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        position: 'relative',\n        paddingBottom: isNextSameSender ? 8 : 16,\n        paddingLeft: 44,\n        paddingRight: 48,\n        justifyContent: 'flex-start',\n        alignItems: 'flex-end',\n      }}\n    >\n      {shouldDisplayAvatar && (\n        <div\n          style={{\n            height: 32,\n            width: 32,\n            position: 'absolute',\n            left: 0,\n            bottom: 20,\n\n            borderRadius: '50%',\n            justifyContent: 'center',\n            alignItems: 'center',\n\n            backgroundPosition: 'center',\n            backgroundSize: 'cover',\n            backgroundImage: `url(${profilePhotoUrl})`,\n          }}\n        />\n      )}\n\n      <div\n        style={{\n          fontSize: 14,\n          borderRadius: 5,\n          padding: '12px 16px',\n          background: 'rgb(245, 245, 245)',\n          color: 'rgba(0,0,0,.65)',\n          whiteSpace: 'pre-wrap',\n        }}\n      >\n        {message.body}\n      </div>\n    </div>\n  );\n};\n\nconst ChatBody = ({state, scrollToRef}: BodyProps) => {\n  const {customerId, messages = []} = state;\n\n  return (\n    <div style={{padding: '16px 16px 0px'}}>\n      {messages.map((message: any, idx: number) => {\n        const isCustomer =\n          message.customer_id === customerId ||\n          (!!message.sent_at && message.type === 'customer');\n        const next = messages[idx + 1];\n        const isNextMessageCustomer =\n          next &&\n          (next.customer_id === customerId ||\n            (!!next.sent_at && next.type === 'customer'));\n        const isNextSameSender = isCustomer === isNextMessageCustomer;\n\n        if (isCustomer) {\n          return (\n            <CustomerMessage\n              key={message.id || idx}\n              message={message}\n              isNextSameSender={isNextSameSender}\n            />\n          );\n        } else {\n          return (\n            <AgentMessage\n              key={message.id || idx}\n              message={message}\n              isNextSameSender={isNextSameSender}\n            />\n          );\n        }\n      })}\n\n      <div key='scroll-el' ref={scrollToRef} />\n    </div>\n  );\n};\n\nexport default ChatBody;\n","import React from 'react';\nimport styled from '@emotion/styled';\n\nconst ToggleButton = styled.button({\n  outline: 'none',\n  border: 'none',\n  userSelect: 'none',\n  cursor: 'pointer',\n  width: '50px',\n  height: '50px',\n  borderRadius: '50%',\n  display: 'flex',\n  justifyContent: 'center',\n  alignItems: 'center',\n\n  '&:focus': {\n    outline: 'none',\n  },\n});\n\nconst OpenIcon = () => {\n  return (\n    <svg width='27' height='27' viewBox='0 0 27 27'>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='0'\n        d='M 7.5 14.5 L 19 14.5'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='0'\n        d='M 7.5 8.5 L 19 8.5'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        d='M22 21.6453C22 20 23 19.5 23 19.5C23 19.5 25.5 18 25.5 14V9C25.5 4 23 1.5 18 1.5H9C4 1.5 1.5 4 1.5 9V14C1.5 19 4 21 9 21H13.5C14 21 14 21 15 21.5L20.25 24.8572L20.8517 25.2118C21.5184 25.6046 22 25.631 22 24.8572V24.0287V22.7858V21.6453Z'\n        opacity='1'\n      ></path>\n    </svg>\n  );\n};\n\nconst CloseIcon = () => {\n  return (\n    <svg width='24' height='25' viewBox='0 0 24 25' fill='none'>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='1'\n        d='M 5 5 L 20 20'\n      ></path>\n      <path\n        fill='transparent'\n        strokeWidth='3'\n        stroke='hsl(0, 0%, 99%)'\n        strokeLinecap='round'\n        opacity='1'\n        d='M 5 20 L 20 5'\n      ></path>\n      <path\n        d='M20.5 21.1453C20.5 19.5 21.5 19 21.5 19C21.5 19 24 18.5 24 13.5V8.5C24 3.5 21.5 1 16.5 1H7.5C2.5 1 0 3.5 0 8.5V13.5C0 18.5 2.5 20.5 7.5 20.5H12C12.5 20.5 12.5 20.5 13.5 21L18.75 24.3572L19.3517 24.7118C20.0184 25.1046 20.5 25.131 20.5 24.3572V23.5287V22.2858V21.1453Z'\n        fill='white'\n        fillOpacity='0.7'\n        opacity='0'\n      ></path>\n      <path\n        fillRule='evenodd'\n        clipRule='evenodd'\n        d='M21.5 18C21.5 18 20.5 18.5 20.5 20.1453V21.2858V22.5287V23.3572C20.5 24.131 20.0184 24.1046 19.3517 23.7118L18.75 23.3572L13.5 20C12.8174 19.6587 12.6007 19.5504 12.3729 19.516C12.267 19.5 12.1587 19.5 12 19.5H7.5C2.5 19.5 0 17.5 0 12.5V7.5C0 2.5 2.5 0 7.5 0H16.5C21.5 0 24 2.5 24 7.5V12.5C24 17.5 21.5 18 21.5 18ZM21 17.557C21.8581 17.557 24 13.557 23 13.057C22.3869 12.7505 21.8801 13.7414 21.4646 14.554C21.2023 15.0668 20.9764 15.5086 20.783 15.5086C20.283 15.5086 20 16.0554 20 16.7568C20 17.4582 20.1419 17.557 21 17.557Z'\n        fill='white'\n        opacity='0'\n      ></path>\n    </svg>\n  );\n};\n\nconst ChatToggle = ({\n  isOpen,\n  onToggleOpen,\n}: {\n  isOpen?: boolean;\n  onToggleOpen: () => void;\n}) => {\n  return (\n    <ToggleButton\n      style={{background: 'rgb(24, 144, 255)'}}\n      onClick={onToggleOpen}\n    >\n      {isOpen ? <CloseIcon /> : <OpenIcon />}\n    </ToggleButton>\n  );\n};\n\nexport default ChatToggle;\n","import React from 'react';\nimport {FooterProps} from './ChatBuilder';\n\nconst ChatFooter = ({config, onSendMessage}: FooterProps) => {\n  const [body, setMessageBody] = React.useState('');\n  const {newMessagePlaceholder = 'Start typing...'} = config;\n\n  const handleChange = (e: any) => setMessageBody(e.target.value);\n\n  const handleSubmit = (e: any) => {\n    e.preventDefault();\n    onSendMessage({body});\n    setMessageBody('');\n  };\n\n  return (\n    <div\n      style={{\n        padding: 8,\n        borderTop: '1px solid rgb(230, 230, 230)',\n        boxShadow: 'rgba(0, 0, 0, 0.1) 0px 0px 100px 0px',\n      }}\n    >\n      <form onSubmit={handleSubmit}>\n        <input\n          style={{\n            border: 'none',\n            boxSizing: 'border-box',\n            width: '100%',\n            padding: 8,\n            outline: 0,\n            fontSize: '1em',\n          }}\n          value={body}\n          placeholder={newMessagePlaceholder}\n          onChange={handleChange}\n        />\n      </form>\n    </div>\n  );\n};\n\nexport default ChatFooter;\n","import React from 'react';\nimport {HeaderProps} from './ChatBuilder';\n\nconst ChatHeader = ({config}: HeaderProps) => {\n  const {title = 'Welcome!', subtitle = 'How can we help you?'} = config;\n\n  return (\n    <div\n      style={{\n        padding: '16px',\n        background: 'rgb(24, 144, 255)',\n        color: '#fff',\n      }}\n    >\n      <h2\n        style={{\n          marginTop: 4,\n          marginBottom: 4,\n          fontWeight: 500,\n          color: 'rgb(255, 255, 255)',\n        }}\n      >\n        {title}\n      </h2>\n      <p style={{margin: 0, color: 'rgba(255, 255, 255, 0.8)'}}>{subtitle}</p>\n    </div>\n  );\n};\n\nexport default ChatHeader;\n"],"names":["PapercupsBranding","React","style","display","margin","justifyContent","alignItems","href","target","rel","color","opacity","transition","noop","setupCustomEventHandlers","w","events","handlers","addEventListener","map","event","removeEventListener","console","error","Logger","debugModeEnabled","this","debug","log","info","warn","getBrowserVisibilityInfo","document","hidden","state","mozHidden","msHidden","webkitHidden","isWindowHidden","addVisibilityEventListener","handler","getUserInfo","win","ArrayProto","Array","prototype","FuncProto","Function","ObjProto","Object","toString","hasOwnProperty","navigator","nativeBind","bind","nativeForEach","forEach","nativeIsArray","isArray","slice","breaker","obj","call","isFunction","f","test","x","isString","isUndefined","each","iterator","context","length","i","l","key","at","ch","text","value","escapee","next","number","string","white","array","object","JSONDecode","\"","\\","/","b","n","r","t","m","e","SyntaxError","c","charAt","isFinite","hex","uffff","parseInt","String","fromCharCode","push","word","source","result","utf8Encode","start","end","stringl","utftext","replace","c1","charCodeAt","enc","substring","windowConsole","windowOpera","opera","screen","userAgent","intl","Intl","nativeIndexOf","indexOf","__NOOP","__NOOPTIONS","includes","str","needle","timestamp","Date","now","trim","extend","args","prop","func","bound","apply","arguments","TypeError","concat","ctor","self","truncate","ret","val","isObject","stripEmptyProperties","v","k","HTTPBuildQuery","formdata","arg_separator","use_val","use_key","arr","encodeURIComponent","join","JSONEncode","mixed_val","quote","escapable","meta","\b","\t","\n","\f","\r","lastIndex","a","holder","gap","mind","partial","toJSON","base64Encode","data","h2","h3","h4","bits","b64","ac","tmp_arr","getQueryParam","url","param","results","RegExp","exec","decodeURIComponent","err","helpers","campaignParams","campaign_keywords","split","kw","params","kwkey","URL","searchEngine","referrer","search","searchInfo","keyword","browser","user_agent","vendor","browserVersion","regex","Internet Explorer Mobile","Microsoft Edge","Chrome","Chrome iOS","UC Browser","Safari","Mobile Safari","Opera","Firefox","Firefox iOS","Konqueror","BlackBerry","Android Mobile","Samsung Internet","Internet Explorer","Mozilla","undefined","matches","match","parseFloat","os","device","referringDomain","timezone","DateTimeFormat","resolvedOptions","timeZone","properties","referring_domain","time_zone","current_url","location","host","pathname","browser_version","_info$browserVersion","screen_height","height","screen_width","width","lib","insert_id","Math","random","time","Box","styled","div","Flex","ChatWindowContainer","isOpen","zIndex","position","bottom","right","maxWidth","minHeight","maxHeight","background","boxShadow","border","borderRadius","overflow","transform","pointerEvents","NotificationsContainer","ToggleButtonContainer","ChatBuilder","props","_this","settings","config","accountId","primaryColor","baseUrl","title","subtitle","greeting","newMessagePlaceholder","emailInputPlaceholder","newMessagesNotificationText","agentAvailableText","agentUnavailableText","showAgentAvailability","customer","metadata","window","new_message_placeholder","email_input_placeholder","new_messages_notification_text","companyName","account","_settings$account","company_name","show_agent_availability","customerId","papercups","getCachedCustomerId","subscriptionPlan","_settings$account2","subscription_plan","setState","updateWidgetSettingsMetadata","type","detail","setOpenState","handleToggleOpen","handleVisibilityChange","scrollIntoView","isLoaded","onChatLoaded","message","onMessageReceived","onMessageSent","isAgentMessage","logger","formatCustomerMetadata","updateExistingCustomer","conversationId","messages","unseenMessages","filter","msg","seen_at","user_id","handleUnseenMessages","presence","list","availableAgents","metas","scrollIntoViewOptions","scrollToEl","payload","shouldDisplayNotifications","doc","some","shouldMarkAsSeen","markMessagesAsSeen","shouldDisplayBranding","handleNewMessageCallbacks","handleMessagesSeen","email","sendNewMessage","isSending","children","isOpenByDefault","componentDidMount","Boolean","hostname","_this3","Papercups","init","awayMessage","onPresenceSync","onSetCustomerId","onSetConversationId","onSetWidgetSettings","onWidgetSettingsLoaded","onMessagesUpdated","onConversationCreated","onMessageCreated","handleNewMessage","subscriptions","EVENTS","customEventHandlers","handleChatLoaded","componentWillUnmount","disconnect","unsubscribe","renderUnreadMessages","notifications","unread","body","customer_id","sent_at","isCustomerMessage","separator","substr","lastIndexOf","flexDirection","flex","onToggleOpen","render","styles","onClose","onSendMessage","handleSendMessage","scrollToRef","el","_this4","Fragment","className","header","overflowY","footer","alt","src","toggle","Component","CustomerMessage","paddingBottom","isNextSameSender","paddingLeft","paddingRight","fontSize","padding","whiteSpace","AgentMessage","profilePhotoUrl","user","profile_photo_url","left","backgroundPosition","backgroundSize","backgroundImage","ToggleButton","button","outline","userSelect","cursor","&:focus","OpenIcon","viewBox","fill","strokeWidth","stroke","strokeLinecap","d","CloseIcon","fillOpacity","fillRule","clipRule","idx","isCustomer","id","ref","useState","setMessageBody","borderTop","onSubmit","preventDefault","boxSizing","placeholder","onChange","marginTop","marginBottom","fontWeight","onClick"],"mappings":"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"}